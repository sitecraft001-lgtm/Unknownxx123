<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web IDE</title>
<style>
:root{--bg:#0f1115;--panel:#1a1d23;--accent:#8b7bff;--muted:#9aa0aa;}
*{box-sizing:border-box;}
body{margin:0;background:var(--bg);color:white;font-family:Inter,system-ui;height:100vh;display:flex;flex-direction:column;overflow:hidden;}

/* Top navbar */
.navbar{flex:0 0 50px;background:#1b1e26;display:flex;align-items:center;gap:12px;padding:0 16px;border-bottom:1px solid #222;}
.navbar button{background:#2a2f3a;border:none;color:white;padding:0;display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:8px;font-size:16px;cursor:pointer;transition:0.2s;}
.navbar .card-name{flex:1;text-align:center;font-weight:bold;font-size:16px;color:white;}

/* Toolbar */
.top{flex:0 0 56px;background:var(--panel);display:flex;align-items:center;justify-content:center;gap:12px;border-bottom:1px solid #222;}
.top button{background:#2a2f3a;border:none;color:white;padding:0;display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:10px;font-size:18px;cursor:pointer;transition:0.2s;}
.top .danger{background:#b23b3b;}
.top button.save-btn{background:#8b7bff;}
#copyBtn{transition: all 0.25s ease;}

/* Copy expand effect */
#copyBtn.copied{background:#2ecc71;color:#0f1115;transform:scale(1.2);}

/* Tabs */
.tabs{flex:0 0 44px;display:flex;background:#16181d;border-bottom:1px solid #222;}
.tab{flex:1;display:flex;align-items:center;justify-content:center;color:var(--muted);cursor:pointer;}
.tab.active{color:var(--accent);border-bottom:2px solid var(--accent);}

/* Editor */
.editor-container{flex:1;display:flex;align-items:center;justify-content:center;padding:16px;}
.editor{display:flex;width:100%;max-width:900px;height:100%;border-radius:12px;background:var(--panel);box-shadow:0 8px 20px rgba(0,0,0,0.6);overflow:hidden;font-family:monospace;font-size:14px;}
.lines{width:50px;background:#13151a;color:#555;padding:12px 6px;text-align:right;overflow:hidden;user-select:none;border-top-left-radius:12px;border-bottom-left-radius:12px;}
textarea{flex:1;background:var(--bg);border:none;color:white;padding:12px;line-height:1.6;resize:none;outline:none;overflow:auto;border-top-right-radius:12px;border-bottom-right-radius:12px;}

/* Run button */
.run{position:fixed;right:16px;bottom:16px;width:56px;height:56px;border-radius:50%;background:var(--accent);border:none;color:white;font-size:22px;box-shadow:0 12px 35px rgba(139,123,255,.5);}

/* Modals */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;transition:0.2s;}
.modal .box{background:#1f222a;padding:24px;border-radius:14px;text-align:center;width:80%;max-width:300px;}
.modal button{margin-top:12px;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;}
.modal h3{margin:0 0 8px 0;}
.modal p{margin:0;font-size:14px;color:#ccc;}
</style>
</head>
<body>

<!-- Top Navbar -->
<div class="navbar">
  <button onclick="checkDiscard()">â¬…</button>
  <div class="card-name" id="cardName">Card Name</div>
</div>

<!-- Toolbar -->
<div class="top">
  <button onclick="undo()">â†©</button>
  <button onclick="redo()">â†ª</button>
  <button class="danger" onclick="showDelete()">ðŸ—‘</button>
  <button id="copyBtn" onclick="copyCode()">ðŸ“‹</button>
  <button class="save-btn" onclick="save()">ðŸ’¾</button>
</div>

<div class="tabs">
  <div class="tab active" onclick="switchTab('html',this)">HTML</div>
  <div class="tab" onclick="switchTab('css',this)">CSS</div>
  <div class="tab" onclick="switchTab('js',this)">JS</div>
</div>

<div class="editor-container">
  <div class="editor">
    <div class="lines" id="lines"></div>
    <textarea id="code"></textarea>
  </div>
</div>

<button class="run" onclick="runCode()">â–¶</button>

<!-- Delete Modal -->
<div class="modal" id="modal">
  <div class="box">
    <h3>Delete Code?</h3>
    <p>This will clear current editor.</p>
    <button class="danger" onclick="clearCode()">Delete</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<!-- Discard Changes Modal -->
<div class="modal" id="discardModal">
  <div class="box">
    <h3>Discard Changes?</h3>
    <p>You have unsaved changes. Are you sure?</p>
    <button class="danger" onclick="discardChanges()">Discard</button>
    <button onclick="closeDiscardModal()">Cancel</button>
  </div>
</div>

<script>
const code = document.getElementById("code");
const lines = document.getElementById("lines");
const copyBtn = document.getElementById("copyBtn");
const modal = document.getElementById("modal");
const discardModal = document.getElementById("discardModal");
const cardNameEl = document.getElementById("cardName");

let projects = JSON.parse(localStorage.getItem("projects")) || [];
let currentIndex = localStorage.getItem("currentProject");
let project = projects[currentIndex] || { html:"<h1>Hello IDE</h1>", css:"", js:"", name:"Untitled" };

let html = project.html, css = project.css, js = project.js;
let current="html";
code.value=html;

let undoStack=[code.value];
let redoStack=[];
let savedValue = code.value; // track saved content

cardNameEl.innerText = project.name || "Untitled";

syncLines();

code.addEventListener("input",()=>{
  undoStack.push(code.value);
  redoStack=[];
  syncLines();
});

code.addEventListener("scroll",()=>{ lines.scrollTop = code.scrollTop; });

function switchTab(t,el){
  save();
  current=t;
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
  code.value=(t=="html"?html:t=="css"?css:js);
  undoStack=[code.value];
  redoStack=[];
  savedValue = code.value;
  syncLines();
}

function save(){
  if(current=="html") html=code.value;
  if(current=="css") css=code.value;
  if(current=="js") js=code.value;
  projects[currentIndex] = { ...projects[currentIndex], html, css, js, name:project.name };
  localStorage.setItem("projects", JSON.stringify(projects));
  savedValue = code.value;
}

// Run
function runCode(){
  save();
  const preview = window.open("", "_blank");
  preview.document.write(`<style>${css}</style>${html}<script>${js}<\/script>`);
  preview.document.close();
}

// Line numbers
function syncLines(){
  let total = code.value.split("\n").length;
  let out="";
  for(let i=1;i<=total;i++) out+=i+"<br>";
  lines.innerHTML=out;
}

// Undo/Redo
function undo(){
  if(undoStack.length>1){
    redoStack.push(undoStack.pop());
    code.value=undoStack[undoStack.length-1];
    syncLines();
  }
}
function redo(){
  if(redoStack.length){
    let v=redoStack.pop();
    code.value=v;
    undoStack.push(v);
    syncLines();
  }
}

// Delete
function showDelete(){ modal.style.display="flex"; }
function closeModal(){ modal.style.display="none"; }
function clearCode(){
  // Push current code to undo before clearing
  undoStack.push(code.value);
  redoStack=[];
  code.value="";
  syncLines();
  closeModal();
}

// Copy with expand effect
function copyCode(){
  navigator.clipboard.writeText(code.value);
  copyBtn.classList.add("copied");
  setTimeout(()=>{
    copyBtn.classList.remove("copied");
  },800);
}

// Discard Changes / Back
function checkDiscard(){
  if(code.value !== savedValue){
    discardModal.style.display = "flex";
  } else {
    history.back();
  }
}
function closeDiscardModal(){ discardModal.style.display="none"; }
function discardChanges(){
  code.value = savedValue;
  syncLines();
  closeDiscardModal();
  history.back();
}
</script>
</body>
</html>
